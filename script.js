Финальный код вставлю отдельно, как обсуждали